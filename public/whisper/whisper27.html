<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WebWorker Handling</title>
</head>
<body>
  <button id="saveWorkerButton">Save Online WebWorker</button>
  <button id="loadWorkerButton">Load Local WebWorker</button>

  <script type="module">
    const saveWorkerButton = document.getElementById('saveWorkerButton');
    const loadWorkerButton = document.getElementById('loadWorkerButton');

    saveWorkerButton.addEventListener('click', async () => {
      const response = await fetch('https://example.com/my-audio-processor.js');
      const workerCode = await response.text();
      
      const newHandle = await window.showSaveFilePicker({
        suggestedName: 'my-audio-processor.js',
        types: [
          {
            description: 'JavaScript Files',
            accept: {
              'application/javascript': ['.js'],
            },
          },
        ],
      });
      
      const writableStream = await newHandle.createWritable();
      await writableStream.write(workerCode);
      await writableStream.close();

      console.log('WebWorker code saved locally.');
    });

    loadWorkerButton.addEventListener('click', async () => {
      const [fileHandle] = await window.showOpenFilePicker({
        types: [
          {
            description: 'JavaScript Files',
            accept: {
              'application/javascript': ['.js'],
            },
          },
        ],
        excludeAcceptAllOption: true,
        multiple: false,
      });
      
      const file = await fileHandle.getFile();
      const workerCode = await file.text();
      
      const blob = new Blob([workerCode], { type: 'application/javascript' });
      const moduleURL = URL.createObjectURL(blob);
      
      const myAudioContext = new AudioContext({ sampleRate: 16000 });
      await myAudioContext.audioWorklet.addModule(moduleURL);
      
      const myWorkletNode = new AudioWorkletNode(myAudioContext, 'my-audio-processor');
      console.log('WebWorker loaded locally.');
      
      // Use myWorkletNode as needed
    });
  </script>
</body>
</html>
